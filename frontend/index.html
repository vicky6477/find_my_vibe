<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Find My Vibe â€“ demo</title>
  <style>
    body{font-family:sans-serif;margin:40px;background:#f9f9f9}
    h1{color:#333}
    .upload-box{padding:20px;background:#fff;border:1px solid #ccc;border-radius:8px;width:400px}
    #preview{margin-top:10px;max-width:100%;max-height:300px;border:1px solid #ddd}
    #results{margin-top:30px}
    .rec{display:inline-block;margin:10px;text-align:center}
    .rec img{width:150px;height:150px;object-fit:cover;border:2px solid #ccc;border-radius:4px}
    .attr{font-weight:bold;margin:2px 0}
    .error{color:red;font-weight:bold}
  </style>
</head>
<body>
  <h1>ðŸ§  Find My Vibe</h1>

  <div class="upload-box">
    <form id="uploadForm">
      <label>Select a fashion image:</label><br/>
      <input type="file" id="imageInput" name="file" accept="image/*" required/><br/>
      <img id="preview" style="display:none"/><br/>
      <button type="submit">Submit</button>
    </form>
  </div>

  <div id="results"></div>

<script>
const imgInput = document.getElementById("imageInput");
const preview  = document.getElementById("preview");

imgInput.onchange = () => {
  const f = imgInput.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = e => { preview.src=e.target.result; preview.style.display="block"; };
  r.readAsDataURL(f);
};

document.getElementById("uploadForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const fd = new FormData(); fd.append("file", imgInput.files[0]);

  const box = document.getElementById("results");
  box.innerHTML = "<p>Processingâ€¦</p>";

  try{
    const res = await fetch("/predict/", {method:"POST", body:fd});
    if(!res.ok) throw new Error("Server error");
    const data = await res.json();

    const attr = data.prediction;
    const styleLines = Object.entries(attr.style_top3)
          .map(([s,p])=>`${s} (${(p*100).toFixed(1)}%)`).join(', ');
    const recHTML = data.recommendations.map(
        u=>`<div class="rec"><img src="${u}"/></div>`).join('');

    box.innerHTML = `
      <div class="attr">ðŸ‘œ Item type : ${attr.item_type}</div>
      <div class="attr">ðŸš» Gender    : ${attr.gender}</div>
      <div class="attr">ðŸŽ¨ Colour    : ${attr.colour}</div>
      <div class="attr">ðŸŒ¦ Season    : ${attr.season}</div>
      <div class="attr">âœ¨ Style top-3: ${styleLines}</div>
      <h3>Recommended items:</h3>
      ${recHTML || '<p class="error">No matches found.</p>'}
    `;
  }catch(err){
    box.innerHTML = `<p class="error">Error: ${err.message}</p>`;
  }
});
</script>
</body>
</html>
